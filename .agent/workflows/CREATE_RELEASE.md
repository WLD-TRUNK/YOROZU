---
description: セマンティックバージョニングに基づくリリース作成と、バージョン入りヘッダー画像の生成を自動化します
---

# 🚀 リリース作成ワークフロー

このワークフローは、`main` ブランチの最新状態からGitHubリリースを作成します。バージョン判定、リリースノート生成、および専用ヘッダー画像の作成を自動化します。

## 手順1: 🌿 準備と確認 // 高速
以下のコマンドを順に実行します。**コマンドはセミコロンで連結せず、必ず1つずつ実行してください。**

1. ブランチの切り替え
   ```bash
   git checkout main
   ```
2. 最新コードの取得
   ```bash
   git pull
   ```
3. 最新タグの確認
   ```bash
   git describe --tags --abbrev=0
   ```
4. ステータスの確認
   ```bash
   git status
   ```

## 手順2: 🏷️ バージョン決定
- **ユーザー指定**: ユーザーが明示的にバージョンを指定した場合（例: `v1.0.0`）、それを採用します。
- **自動判定**: 指定がない場合、前回のタグからの変更内容（コミットメッセージの `feat`, `fix`, `BREAKING CHANGE` 等）に基づいてセマンティックバージョニングで決定します。
  - 初回リリースやアルファ段階の場合、ユーザーに確認しつつ推奨値（例: `v0.1.0-alpha`）を提案します。
  - **現状**: このリポジトリは **アルファテスト中** です。プレレリースタグ（`-alpha`）の付与を推奨します。

## 手順3: 🎨 リリース用ヘッダー画像生成
- `.agent/assets/HEADER_PROMPT.txt` の内容をベースに、**リポジトリ名とバージョン番号** を含む画像を生成します。
- **プロンプト構築**:
  - ベース: `.agent/assets/HEADER_PROMPT.txt`（雅（Miyabi）スタイル）
  - 追加指示: 「英字の『[リポジトリ名] [バージョン]』を上品に配置する」
  - **重要**: 画像内の文字は英字のみとし、漢字・ひらがな・カタカナは含めません。
- **生成と保存**:
  - ツール: `generate_image`, `.agent/scripts/CROP_HEADER.ps1`
  - 保存先: `.agent/assets/release_header_[version].png`

## 手順4: 📝 洗練されたリリースノートの生成  // 高速

### 4.1 情報収集
```bash
# 変更ファイル一覧
git diff --stat [前タグ]..HEAD

# コミットログ（種別付き）
git log --oneline --pretty=format:"%s (%h)" [前タグ]..HEAD

# 貢献者一覧
git log --format='%an' [前タグ]..HEAD | sort -u
```

### 4.2 テンプレート適用
- `.agent/templates/RELEASE_NOTES_TEMPLATE.md` をベースに生成
- 各セクションをコミット分析結果で埋める
- 破壊的変更がある場合はマイグレーションガイドを必須で含める
- 見出し・本文は日本語で統一する（固有名詞は英語併記可）

### 4.3 品質チェック
- [ ] 概要 が3文以内で要点を伝えているか
- [ ] 各変更にPR/課題リンクがあるか
- [ ] コード例が動作するか
- [ ] 画像/GIFが適切に表示されるか

## 手順5: 🚀 リリース作成 // 高速
- `gh release create` コマンドを使用してリリースを作成します。
  - **タグ**: 手順2で決定したタグ。
  - **ノート**: `-F release_notes.md` オプションで作成したノートを指定します。
  - **アセット**: 手順3で生成したヘッダー画像を添付します。
  - **オプション**: `--title "[タグ名]"`、アルファ/ベータの場合は `--prerelease`。

  ```bash
  # 例
  gh release create v0.1.0-alpha \
    --title "v0.1.0-alpha" \
    -F release_notes.md \
    --prerelease \
    .agent/assets/release_header_v0.1.0-alpha.png
  ```

## 手順6: 📢 完了通知 // 高速
- リリースが作成されたURLをユーザーに通知します。
