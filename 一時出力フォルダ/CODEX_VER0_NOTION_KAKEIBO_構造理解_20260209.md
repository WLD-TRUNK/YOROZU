# CODEX_家計簿_ver.0 構造理解メモ（実環境参照）

作成日: 2026-02-09  
対象ページ: `CODEX_家計簿_ver.0`  
ページID: `2f2d8928-02b6-809c-963e-c1c05ef26aa0`

参照元:
- `一時出力フォルダ/CODEX_VER0_notion_live_snapshot_20260209.json`
- `一時出力フォルダ/CODEX_KAKEIBO_VER0_CATEGORY_WEEKLY_FORMULA.md`

## 1. ページ全体の構成
`CODEX_家計簿_ver.0` は、1ページ内に次を束ねるハブ構造。

- スマホ用Home（表示ビュー）
- 最近の支出（10件）ビュー
- スマート登録ページ
- 取引DB群（支出/収入/貯蓄/ローン返済/ローン）
- 集計DB群（日別/月別/カテゴリ別/BS）
- 中間DB（relationハブ）
- 補助ビューDB（LIST, New database, 一部Untitled）

## 2. データベース構造（取得できた実体）
主要DB（取得成功）:
- `収入DB` `2f2d8928-02b6-8103-a6cd-cd0ca1b8eafa`
- `支出DB` `2f2d8928-02b6-8171-a50b-ff20b7fa8a18`
- `貯蓄DB` `2f2d8928-02b6-81ba-9e41-cfd0d27dac0d`
- `ローン返済DB` `2f2d8928-02b6-8146-95c7-d72c6520ef55`
- `ローンDB` `2f2d8928-02b6-81d9-b320-c798810c7bc9`
- `日別集計DB` `2f2d8928-02b6-8120-8269-d02a8d4ca934`
- `月別集計DB` `2f2d8928-02b6-8115-a87a-d43db1f010b6`
- `カテゴリー別集計DB` `2f2d8928-02b6-812d-9afb-d5c59976e253`
- `B/S_DB` `2f2d8928-02b6-81ba-98bc-c475a7ddccb2`
- `中間DB` `2f2d8928-02b6-81f1-9510-e9f11e067dbb`

補助DB:
- `LIST` `2f2d8928-02b6-8167-a9e2-cc44000843a0`
- 無題DB `2f2d8928-02b6-81bb-9085-f2b4e4939e55`

## 3. relation設計（中心は中間DB）
ver.0 のrelationは `中間DB` 中心で設計されている。

中間DB -> 各DB:
- `支出一覧` -> 支出DB
- `月` -> 月別集計DB
- `日別集計` -> 日別集計DB
- `カテゴリー別集計` -> カテゴリー別集計DB
- `貯蓄DB` -> 貯蓄DB
- `B/S_DB` -> B/S_DB
- `ローン返済DB` -> ローン返済DB
- `ローンDB` -> ローンDB

逆向き:
- 各集計/取引DBが `中間DB` relationを1本持つ（収入DB除く）

## 4. 計算ロジックの役割（formulaの意図）
### 4.1 月別集計DB（formula 5本）
- `収入合計`
- `支出合計`
- `支出 / 予算`
- `支出 / 収入`
- `収入 - 支出`

意図:
- 月単位の収支と予算比率を把握する基盤。

### 4.2 日別集計DB（formula 4本）
- `日別_合計`
- `消費合計`
- `🎟️枚`
- `💎枚`

意図:
- 日次消費の可視化と、500円/5000円単位のチケット化。

### 4.3 カテゴリー別集計DB（formula 14本）
- `1月`〜`12月` の月別集計
- `合計`
- `集計テーブル`

意図:
- カテゴリ単位で年間推移を追跡し、`集計テーブル` でバー表示する。
- `CODEX_KAKEIBO_VER0_CATEGORY_WEEKLY_FORMULA.md` にある通り、バー表示は ver.0 の中核UI。

### 4.4 B/S_DB（formula 3本）
- `TOTAL`
- `ローン返済合計`
- `貯蓄`

意図:
- 貯蓄と返済を統合したバランス把握。

### 4.5 ローンDB（formula 2本）
- `残返済金額合計_BS`
- `返済元金合計_BS`

意図:
- ローン残高/返済進捗をB/Sに接続。

## 5. ver.0としての設計意図（読み取り）
- ver.1より対象範囲が広く、単純な家計簿より「家計全体（支出・貯蓄・ローン・BS）」管理寄り。
- `中間DB` を中核にして、複数集計軸（日・月・カテゴリ・BS）を同時に成立させる設計。
- スマホ用Homeと最近支出ビューがあり、入力/閲覧導線を1ページで完結させる思想。

## 6. 注意点（実環境）
- `child_database` の一部IDは `/v1/databases/{id}` で `400` になり、ビュー専用IDの可能性が高い。
- そのため、構造理解は「取得できる実DB ID」を基準にするのが安全。
